<!DOCTYPE html>
<html lang="en">

<head>
    <title>Suspense</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
</head>

<body class="shower list">

    <header class="caption">
        <h1>Suspended world</h1>
    </header>

    <section class="slide" id="cover">
        <h2>React Suspense</h2>
        <figure style="margin-top: 120px">
            <blockquote>
                <p>React.Suspense lets you specify the loading indicator in case some components in the tree below it
                    are not yet ready to render.</p>
            </blockquote>
            <figcaption><a target="_blank" href="https://reactjs.org/docs/react-api.html#reactsuspense">React Docs</a>
            </figcaption>
        </figure>
    </section>

    <section class="slide">
        <h2>Suspense for lazy loading</h2>
        <pre>
            <code>const ComponentLazy = React.lazy(() => {</code>
            <code>  return <mark>import('./Component');</mark></code>
            <code>});</code>
            <code> </code>
            <code>&lt;React.Suspense fallback={<mark>&lt;div&gt;loading...&lt;/div&gt;</mark>}&gt;</code>
            <code>  <mark>&lt;ComponentLazy /&gt;</mark></code>
            <code>&lt;/React.Suspense&gt;</code>
        </pre>
    </section>

    <section class="slide black clear">
        <iframe class="shout"
            src="https://codesandbox.io/embed/determined-cookies-cwts2?fontsize=14&hidenavigation=1&module=%2Fsrc%2FApp.js&theme=dark&view=preview"
            style="width:100%; height:510px; border:0; border-radius: 4px; overflow:hidden;"
            title="determined-cookies-cwts2"
            allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
            sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
    </section>

    <section class="slide">
        <h2>Reusable pattern for modals</h2>

        <pre>
            <code>const ModalAppLazy = React.lazy(() => import('./App'));</code>
            <code> </code>
            <code>&lt;Modal isOpen={isOpen}&gt;</code>
            <code>  &lt;React.Suspense fallback={&lt;LoadingState /&gt;}&gt;</code>
            <code>    &lt;ModalAppLazy {...props} /&gt;</code>
            <code>  &lt;/React.Suspense&gt;</code>
            <code>&lt;/Modal&gt;</code>
        </pre>
    </section>

    <section class="slide black clear">
        <iframe class="shout"
            src="https://codesandbox.io/embed/charming-galois-xpilz?fontsize=14&hidenavigation=1&module=%2Fsrc%2FApp.js&theme=dark&view=preview"
            style="width:100%; height:510px; border:0; border-radius: 4px; overflow:hidden;"
            title="charming-galois-xpilz"
            allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
            sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
    </section>

    <section class="slide">
        <h2>Benefits</h2>
        <ol>
            <li>Simple loading state management
                <p>React automatically manages ready, loading and error states.</p>
            </li>
            <li>Code splitting
                <p>Dynamically imported components are splitted into chunks.</p>
            </li>
            <li>Performance
                <p>Chunks are loaded on demand.</p>
            </li>
        </ol>
    </section>

    <section class="slide">
        <h2>Suspense for Data fetching</h2>
        <figure style="margin-top: 120px">
            <blockquote>
                <p>Suspense for Data Fetching is a new feature that lets you also use <Suspense> to declaratively “wait”
                        for anything else, including data.</p>
            </blockquote>
            <figcaption><a href="https://reactjs.org/docs/concurrent-mode-suspense.html">React Docs</a></figcaption>
        </figure>
    </section>

    <section class="slide">
        <h2>Resource</h2>
        <pre>
            <code>const Comp = ({ resource }) => &lt;div&gt;{<mark>resource.read()</mark>}&lt;/div&gt;</code>
            <code> </code>
            <code>&lt;ErrorBoundary fallback={&lt;ErrorState /&gt;}&gt;</code>
            <code>  &lt;React.Suspense fallback={&lt;LoadingState /&gt;}&gt;</code>
            <code>    &lt;Comp resource={<mark>createResource(fetch(props.url))</mark>} /&gt;</code>
            <code>  &lt;/React.Suspense&gt;</code>
            <code>&lt;/ErrorBoundary&gt;</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Resource internally</h2>
        <pre>
            <code>read() {</code>
            <code>  if (status === 'pending') <mark>throw promise;</mark></code>
            <code>  if (status === 'failure') throw error;</code>
            <code>  if (status === 'success') return result;</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide black clear">
        <iframe class="shout"
            src="https://codesandbox.io/embed/recursing-vaughan-gyq5k?fontsize=14&hidenavigation=1&theme=dark&view=preview"
            style="width:100%; height:510px; border:0; border-radius: 4px; overflow:hidden;"
            title="recursing-vaughan-gyq5k"
            allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
            sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
    </section>

    <section class="slide">
        <h2>Benefits</h2>

        <ul>
            <li>The same Suspense mechanism
                <p>Suspense can be used for both Lazy components and Data fetching.</p>
            </li>
            <li>Easy-to-use and easy-to-maintain
                <p>Works on a core level of React. No need for a custom state management.</p>
            </li>
        </ul>
    </section>

    <section class="slide">
        <h2>A little problem</h2>

        <div style="line-height: 1;">
            <img class="twitter-problem__1 animation" width="420vw" src="pictures/problem_1.png" />
            <img class="twitter-problem__2 animation" width="500vw" src="pictures/problem_2.png" />
            <img class="twitter-problem__3 animation" width="600vw" src="pictures/problem_3.png" />
            <img class="twitter-problem__4 animation" width="800vw" src="pictures/problem_4.png" />
            <div class="twitter-problem__sadness next animation">:<span style="color: #4B86C2">*</span>(</div>

            <a class="twitter-problem__link" target="_blank"
                href="https://twitter.com/orimarron/status/1192729465345970176">Link</a>
        </div>
        <style>
            img {
                position: relative;
                left: 0;
                top: 0;
                width: 450px;
                transform: translate3d(0, 0, 0) scale(1.0);
            }

            .twitter-problem__sadness {
                position: absolute;
                z-index: 3;
                bottom: 20px;
                left: 520px;
                font-size: 30px;
            }

            .twitter-problem__4 {
                z-index: 2;
            }

            .twitter-problem__link {
                display: block;
                width: 46px;
            }

            .twitter-problem__sadness.animation {
                z-index: 1;
                transform: translate3d(0, -200%, 0);
                transition: transform 500ms;
            }

            .twitter-problem__sadness.animation.active,
            .visited .twitter-problem__sadness {
                transform: translate3d(0, 0, 0) rotate(30deg);
            }
        </style>
    </section>

    <section class="slide">
        <h2>Solution — Libraries</h2>

        <ul>
            <li><a target="_blank" href="https://relay.dev/">react-relay</a></li>
            <li><a target="_blank" href="https://github.com/tannerlinsley/react-query">react-query</a></li>
            <li><a target="_blank" href="https://www.npmjs.com/package/react-cache">react-cache</a></li>
            <li><a target="_blank" href="https://swr.now.sh/">react swr</a></li>
        </ul>
    </section>

    <section class="slide">
        <h2>react-query</h2>

        <pre>
            <code>const AssetViewer = ({ assetId }) => {</code>
            <code>  const { data } = <mark>useQuery</mark>(</code>
            <code>    ['uniqueCacheKey', { assetId }],</code>
            <code>    api.fetchAsset,</code>
            <code>    { <mark>suspense: true</mark>, staleTime: 10000 }</code>
            <code>  );</code>
            <code>}</code>
        </pre>
    </section>

    <section class="slide">
        <h2>react-query</h2>

        <ul>
            <li>Easy-to-use hook for a data fetching</li>
            <li>Cache invalidation out of the box</li>
            <li>Indirect suspense dependency</li>
        </ul>
    </section>

    <section class="slide">
        <h2 class="shout">Concurrent Future</h2>
        <h6 class="future__note">* experimental</h6>
        <style>
            .future__note {
                position: absolute;
                left: 30px;
                bottom: 0;
            }
        </style>
    </section>

    <section class="slide">
        <h2>Suspense List</h2>

        <pre>
            <code>&lt;React.SuspenseList <mark>revealOrder="forwards"</mark>&gt;</code>
            <code>  &lt;Suspense fallback="⌛"&gt;<mark>&lt;Header /&gt;</mark>&lt;/Suspense&gt;</code>
            <code>  &lt;Suspense fallback="⌛"&gt;<mark>&lt;Navigation /&gt;</mark>&lt;/Suspense&gt;</code>
            <code>  &lt;Suspense fallback="⌛"&gt;<mark>&lt;Menu /&gt;</mark>&lt;/Suspense&gt;</code>
            <code>  &lt;Suspense fallback="⌛"&gt;<mark>&lt;Footer /&gt;</mark>&lt;/Suspense&gt;</code>
            <code>&lt;/React.SuspenseList&gt;</code>
        </pre>
    </section>

    <section class="slide black clear">
        <iframe class="shout"
            src="https://codesandbox.io/embed/black-rain-twn1l?fontsize=14&hidenavigation=1&theme=dark&view=preview"
            style="width:100%; height:510px; border:0; border-radius: 4px; overflow:hidden;" title="black-rain-twn1l"
            allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
            sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
    </section>

    <section class="slide black clear">
        <iframe class="shout"
            src="https://codesandbox.io/embed/epic-rain-9mzut?fontsize=14&hidenavigation=1&theme=dark&view=preview"
            style="width:100%; height:510px; border:0; border-radius: 4px; overflow:hidden;" title="epic-rain-9mzut"
            allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"
            sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
    </section>

    <section class="slide">
        <h2>Future React APIs</h2>

        <ul>
            <li>SuspenseList
                <p>A brand new component for orchestrating multiple Suspense components.</p>
            </li>
            <li>useTransition
                <p>A new hook which allows the component to preserve the previous version while the new one is still
                    loading.</p>
            </li>
        </ul>
    </section>

    <section class="slide">
        <h6 style="margin: 0; font-size: 24px;" class="shout">Thanks! Any questions?</h6>
    </section>

    <div class="progress"></div>

    <script src="shower/shower.min.js"></script>
</body>

</html>